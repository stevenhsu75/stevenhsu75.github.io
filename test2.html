<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Landmark 68 Detection</title>
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
</head>
<body>
    <h1>Face Landmark 68 Detection with face-api.js</h1>
    <input type="file" id="imageUpload" accept="image/*">
    <canvas id="canvas"></canvas>
    <script>
        // 加载预训练的 face-api.js 模型
        async function loadModels() {
            console.log("Models loaded start");
            await faceapi.nets.ssdMobilenetv1.loadFromUri('/models');
            await faceapi.nets.faceLandmark68Net.loadFromUri('/models');
            await faceapi.nets.faceRecognitionNet.loadFromUri('/models');
            console.log("Models loaded end");
        }

        // 处理上传的图片
        document.getElementById('imageUpload').addEventListener('change', async (event) => {
            const image = await faceapi.bufferToImage(event.target.files[0]);
            document.body.append(image);
            
            // 获取 canvas 元素
            const canvas = document.getElementById('canvas');
            const displaySize = { width: image.width, height: image.height };
            faceapi.matchDimensions(canvas, displaySize);
            
            // 检测人脸及其关键点
            const detections = await faceapi.detectSingleFace(image).withFaceLandmarks();
            
            // 在 canvas 上绘制面部关键点
            const resizedDetections = faceapi.resizeResults(detections, displaySize);
            faceapi.draw.drawDetections(canvas, resizedDetections);
            faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);
        });

        // 初始化模型加载
         window.onload = loadModels;
    </script>
</body>
</html>
